import{$ as Z,A as x,Aa as Q,B as N,Ba as X,C as y,Ca as tt,D as P,E as w,F as C,G as L,H as z,J as $,K as R,L as U,M as V,N as W,R as B,T as A,V as G,X as H,aa as Y,ba as J,d as S,da as q,e as T,f as v,h as f,i as O,j as M,k as E,l as s,m as b,n as m,o as l,p as r,q as o,r as h,s as F,t as k,u as I,v as u,w as c,x as j,y as i,z as g,za as K}from"./chunk-OCGON72V.js";var _=class n{constructor(e){this.router=e}auth=Q();logout(){K(this.auth).then(()=>{this.router.navigate(["/login"])})}static \u0275fac=function(t){return new(t||n)(b(B))};static \u0275cmp=f({type:n,selectors:[["app-menu-global"]],standalone:!0,features:[C],decls:13,vars:0,consts:[[1,"topbar"],[1,"logo"],["src","logopp.png","alt","Logo"],[1,"nav-links"],["routerLink","/dashboard","routerLinkActive","active"],["routerLink","/usuarios","routerLinkActive","active"],[1,"actions"],[3,"click"]],template:function(t,a){t&1&&(r(0,"header",0)(1,"div",1),h(2,"img",2),r(3,"span"),i(4,"Panel Price"),o()(),r(5,"nav",3)(6,"a",4),i(7,"Dashboard"),o(),r(8,"a",5),i(9,"Usu\xE1rios"),o()(),r(10,"div",6)(11,"button",7),u("click",function(){return a.logout()}),i(12,"Sair"),o()()())},styles:['@charset "UTF-8";.topbar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:12px 40px;background:#fff;border-bottom:1px solid #eee;font-family:Inter,sans-serif}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;font-size:20px;font-weight:700;color:#0d47a1}.logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:28px}.nav-links[_ngcontent-%COMP%]{display:flex;gap:24px}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;font-size:15px;color:#333;transition:color .2s ease;cursor:pointer}.nav-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .nav-links[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#0d47a1;font-weight:500}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#0d47a1;color:#fff;border:none;border-radius:20px;padding:8px 18px;font-size:14px;cursor:pointer;transition:background .2s ease}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#08306b}']})};var at={production:!0,apiUrl:"https://panelprice-backend-official.onrender.com/api/v1"};var D=class n{constructor(e,t){this.http=e;this.zone=t}apiUrl=at.apiUrl;getDashboardStream(){return new S(e=>{let t=new EventSource(`${this.apiUrl}/stream`);return t.onmessage=a=>{this.zone.run(()=>{e.next(JSON.parse(a.data))})},t.onerror=a=>{this.zone.run(()=>{e.error(a)}),t.close()},()=>{t.close()}})}getDashboardWithFilters(e){return this.http.get(`${this.apiUrl}/dashboard`,{params:e})}getDashboard(){return this.http.get(`${this.apiUrl}/dashboard`)}static \u0275fac=function(t){return new(t||n)(v(W),v(E))};static \u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"})};var it=(n,e)=>({positive:n,negative:e});function st(n,e){if(n&1&&(r(0,"option",21),i(1),o()),n&2){let t=e.$implicit;l("value",t),s(),g(t)}}function dt(n,e){if(n&1){let t=I();r(0,"div",11)(1,"div",12)(2,"span",13),i(3),o(),r(4,"h4"),i(5),o()(),r(6,"div",14),i(7),o(),r(8,"div",15)(9,"span",16),i(10),o(),r(11,"span",17),i(12),o()(),r(13,"div",18)(14,"label"),i(15,"Filtrar:"),o(),r(16,"select",19),w("ngModelChange",function(d){let p=O(t).$implicit;return P(p.filter,d)||(p.filter=d),M(d)}),u("change",function(){let d=O(t).$implicit,p=c();return M(p.applyFilter(d))}),m(17,st,2,2,"option",20),o()()()}if(n&2){let t=e.$implicit;s(3),g(t.icon),s(2),g(t.title),s(2),x(" ",t.value," "),s(2),l("ngClass",L(9,it,t.growth>=0,t.growth<0)),s(),N(" ",t.growth>=0?"+":"","",t.growth,"% "),s(2),g(t.subtext),s(4),y("ngModel",t.filter),s(),l("ngForOf",t.filterOptions)}}function lt(n,e){if(n&1&&(r(0,"th"),i(1),o()),n&2){let t=e.$implicit;s(),g(t)}}function ct(n,e){if(n&1&&(F(0),i(1),k()),n&2){let t=c().$implicit,a=c().$implicit,d=c();s(),x(" ",d.formatCurrency(a[t],t)," ")}}function pt(n,e){if(n&1&&i(0),n&2){let t=c().$implicit,a=c().$implicit;x(" ",a[t]," ")}}function mt(n,e){if(n&1&&(r(0,"td"),m(1,ct,2,1,"ng-container",22)(2,pt,1,1,"ng-template",null,0,z),o()),n&2){let t=e.$implicit,a=j(3),d=c(2);s(),l("ngIf",d.isMoneyColumn(t))("ngIfElse",a)}}function ht(n,e){if(n&1&&(r(0,"tr"),m(1,mt,4,2,"td",10),o()),n&2){let t=c();s(),l("ngForOf",t.tabelaColunas)}}var nt=class n{constructor(e){this.dashboardService=e}filtros=[];estadoLojaData;estadoPrecoData;cidadePrecoData;tabelaDados=[];tabelaColunas=[];dashboardCards=[];chartOptions={responsive:!0,plugins:{legend:{display:!1}},tooltip:{enabled:!0,callbacks:{label:function(e){let t=e.label||"",a=e.raw||0;return`${t}: ${a}`}}}};searchTerm="";atualizarDashboard(e){this.dashboardCards=e.cards,this.filtros=e.filters,this.tabelaDados=e.table,this.estadoLojaData=e.chartEstadosLojas,this.estadoPrecoData=e.chartEstadosPrecos,this.cidadePrecoData=e.chartCidadePrecos,this.tabelaDados.length>0&&(this.tabelaColunas=Object.keys(this.tabelaDados[0]))}ngOnInit(){this.dashboardService.getDashboard().subscribe(e=>this.atualizarDashboard(e))}filteredData(){if(!this.searchTerm)return this.tabelaDados;let e=this.searchTerm.toLowerCase();return this.tabelaDados.filter(t=>Object.values(t).some(a=>a!=null&&a.toString().toLowerCase().includes(e)))}updateFilter(e,t){let a=this.filtros.find(d=>d.label===e);a&&(a.value=t)}applyFilter(e){let t={};this.dashboardCards.forEach(a=>{if(a.filter)switch(a.title){case"Estados com Lojas":t.estado=a.filter;break;case"Cidades com Lojas":t.cidade=a.filter;break;case"Lojas":t.loja=a.filter;break;case"Produtos Internos":t.produto=a.filter;break}}),console.log("Filtros enviados:",t),this.dashboardService.getDashboardWithFilters(t).subscribe(a=>this.atualizarDashboard(a))}isMoneyColumn(e){if(!e)return!1;let t=e.toLowerCase();return t.includes("valor interno")||t.includes("valor externo")||t.includes("diferenca")||t.includes("diferen\xE7a")}formatCurrency(e,t){if(e==null||e==="")return"-";let a=Number(e);if(isNaN(a))return String(e);let d=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(a);return t&&t.toLowerCase().includes("diferen")?(a>0?"+":"")+d:d}static \u0275fac=function(t){return new(t||n)(b(D))};static \u0275cmp=f({type:n,selectors:[["app-dashboard"]],standalone:!0,features:[C],decls:32,vars:16,consts:[["normalValue",""],[1,"dashboard-page"],[1,"dashboard-container"],[1,"dashboard-cards"],["class","dashboard-card",4,"ngFor","ngForOf"],[1,"charts-row"],[1,"chart-card"],["baseChart","",3,"data","labels","options","type"],[1,"table-card"],["type","text","placeholder","Buscar...",1,"search-input",3,"ngModelChange","ngModel"],[4,"ngFor","ngForOf"],[1,"dashboard-card"],[1,"card-header"],[1,"card-icon"],[1,"card-value"],[1,"card-info"],[1,"card-growth",3,"ngClass"],[1,"card-subtext"],[1,"card-footer"],[3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[4,"ngIf","ngIfElse"]],template:function(t,a){t&1&&(r(0,"div",1)(1,"div",2),h(2,"app-menu-global"),r(3,"h1"),i(4,"Dashboard"),o(),r(5,"p"),i(6,"Bem-vindo ao painel de controle!"),o(),r(7,"div",3),m(8,dt,18,12,"div",4),o(),r(9,"div",5)(10,"div",6)(11,"h3"),i(12,"N\xFAmero de lojas por estado"),o(),h(13,"canvas",7),o(),r(14,"div",6)(15,"h3"),i(16,"Cidade Com maior Pre\xE7o Medio"),o(),h(17,"canvas",7),o(),r(18,"div",6)(19,"h3"),i(20,"Estado com maior pre\xE7o m\xE9dio"),o(),h(21,"canvas",7),o()(),r(22,"div",8)(23,"h3"),i(24,"Detalhes dos Produtos"),o(),r(25,"input",9),w("ngModelChange",function(p){return P(a.searchTerm,p)||(a.searchTerm=p),p}),o(),r(26,"table")(27,"thead")(28,"tr"),m(29,lt,2,1,"th",10),o()(),r(30,"tbody"),m(31,ht,2,1,"tr",10),o()()()()()),t&2&&(s(8),l("ngForOf",a.dashboardCards),s(5),l("data",a.estadoLojaData)("labels",a.estadoLojaData.labels)("options",a.chartOptions)("type","pie"),s(4),l("data",a.cidadePrecoData)("labels",a.cidadePrecoData.labels)("options",a.chartOptions)("type","pie"),s(4),l("data",a.estadoPrecoData)("labels",a.estadoPrecoData.labels)("options",a.chartOptions)("type","pie"),s(4),y("ngModel",a.searchTerm),s(4),l("ngForOf",a.tabelaColunas),s(2),l("ngForOf",a.filteredData()))},dependencies:[V,$,R,U,q,Y,J,A,Z,G,H,tt,X,_],styles:['@charset "UTF-8";.dashboard-page[_ngcontent-%COMP%]{padding:20px;font-family:Inter,sans-serif;background-color:#f5f6fa}.dashboard-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto}.dashboard-cards[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:50px;flex-wrap:wrap;margin-bottom:30px}.dashboard-card[_ngcontent-%COMP%]{flex:1;min-width:220px;max-width:260px;background-color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 4px 12px #00000014;transition:transform .2s}.dashboard-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.card-header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.card-icon[_ngcontent-%COMP%]{font-size:24px}.card-value[_ngcontent-%COMP%]{font-size:22px;font-weight:700;margin:8px 0}.card-info[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.card-growth.positive[_ngcontent-%COMP%]{color:green}.card-growth.negative[_ngcontent-%COMP%]{color:red}.card-subtext[_ngcontent-%COMP%]{font-size:12px;color:#666}.card-footer[_ngcontent-%COMP%]{margin-top:8px}.card-footer[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:5px;border-radius:6px;border:1px solid #ccc;margin-bottom:5px}.charts-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;gap:20px;margin-bottom:30px;flex-wrap:wrap}.chart-card[_ngcontent-%COMP%]{flex:1;min-width:250px;max-width:380px;background-color:#fff;padding:12px;border-radius:12px;box-shadow:0 4px 12px #00000014;transition:transform .2s}.chart-card[_ngcontent-%COMP%]:hover{transform:translateY(-3px)}.chart-card[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{max-height:220px;width:100%!important}.table-card[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 12px #00000014;overflow-x:auto}.table-card[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:10px}.search-input[_ngcontent-%COMP%]{width:100%;padding:8px;margin-bottom:15px;border-radius:6px;border:1px solid #ccc;outline:none}table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{text-align:left;padding:10px;border-bottom:1px solid #eee}th[_ngcontent-%COMP%]{background-color:#27284a;color:#fff;font-weight:600;text-align:center}@media (max-width: 768px){.charts-row[_ngcontent-%COMP%]{flex-direction:column}.dashboard-cards[_ngcontent-%COMP%]{justify-content:center}}']})};export{nt as DashboardComponent};
